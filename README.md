# DSTU ConnectBot 
## Описание:
Телеграмм-бот , созданный для быстрого поиска полезных знакомств в любимом университете: 
- Поиск товарищей для реализации своих задумок, проектов или команды для хакатона;
- Поиск интересных собеседников , среди других прекрасных личностей;
- Поиск той самой второй половинки, с которой вы напишите прекрасный диплом и нарожаете много прекрасных номеров для студ весны.
### Реализовано:
- создание/удаление собственной анкеты
- поиск и просмотр чужих анкет
- отправка заявки другому пользователю
- изменение всех параметров собственной анкеты

## Технологии в проекте:
Проект написан на Python 3 c использованием таких библиотек как:python-telegram-bot,sqlalchemy,random,pathlib.
Была использована ORM-модель sqlalchemy.

## Техническое описание проекта:

проект предлагается в **исходном коде**. 
**Исходный код** состоит из запускающего файла - **main.py**
- **Файл run.py** -   файл запуска телеграм-бота
- **Файл utils.py**  -  файл с основными методами, такими как создание анкеты и тому подобное
- **Файл update.py** - файл с методами обновления данных
- **Файл search.py** - файл с методами взаимодействия с другими анкетами
- **Файл db.py** - файл инициализирующих работу БД
- **members-sqlalchemy.db** файл-таблица базы данных , где хранятся анкеты
- **member-sqlalchemy.db-journal** файл с временной базой данных, в котором содержится наибольшее состояние уточненной базы данных(нужен для восстановления БД при ошибках)

Так же **обязательными** является папка **photo**, в которой хранятся фотографии анкет и файл самой БД **members-sqlalchemy.db**, в которой хранятся сами анкеты пользователей, а также **1.mp3** файл, для реализации пакета аудио

## Инструкция запуска своего бота на примере запуска через хостинг Glitch: 
- В Telegram перейти в бот https://t.me/BotFather для создания и получения токена своего бота.
- написать данные команды в бота: **/start** , **/newbot** . 
- после этого пишем имя бота, а после этого его  username(это будет ссылкой на вашего бота),далее получаем такое сообщение:![image](https://user-images.githubusercontent.com/81232295/226204701-0e6f0dcd-4ad5-4d0e-a0ef-56db4a201a0c.png)
- в данном сообщении нас интересует следующий элемент, который мы копируем:

![image](https://user-images.githubusercontent.com/81232295/226204788-49a8a01e-e320-43b6-acdd-bb5942eea76f.png)

- вставляем токен в файле **run.py** в 15 строку и сохраняем изменения в файле.

![image](https://user-images.githubusercontent.com/81232295/226204889-71370e29-2829-46f2-a83a-824463926e94.png)

- создаем собственный репозиторий на github с данными файлами проекта( но если хотите получить чистую базу данных, то удалите все изображения из папки photo и удалите БД **members-sqlalchemy.db**(не волнуйтесь, при запуске проекта создастся новая)) 
- заходим на сайт https://glitch.com/ , где регистрируемся.
- нажимаем в вверхнем правом углу кнопку **new project** и добавляем ссылку на ваш git-репозиторий.
- затем в нижней строчке находим терминал куда прописываем **pip3 install -r requirements. txt**.
- и для запуска проекта прописываем в том же терминале **python3 main.py**.
- ГОТОВО!
- далее следуем инструкции ниже.

## Инструкция запуска бота на локальном сервере(ubuntu):
- в терминале пишем команду **pip3 install -r requirements. txt**, или же вручную **pip3 install python-telegram-bot** и **pip3 install sqlalchemy**
- потом переходим в папку проекта с помощью команды **cd /<название папки проекта>**
- после этого пишем команду **nohup main.py &**(данная команда запустит процесс в фоновом режиме, и даже при закрытии терминала процесс продолжит работу)


## Инструкция использования  данного бота(отличие от использования вашего бота только в ссылке):

- перейдите в бота по ссылке https://t.me/DSTUConnectbot
- нажмите команду **/start**
- для создания анкеты напишите **/create_form**
- после создания анкеты вы можете ее посмотреть через **/show_form**
- для поиска других пользователей напишите **/search_form** , вам выдаст одну анкету. Для выдачи следующей анкеты напишите снова **/search_form**
- для того чтобы посмотреть полный функционал бота напишите **/help**

## Работа Базы данных в проекте:
- при создании анкеты создается строка в таблице, где ключом является id чата
- при обновлении данных анкеты создается запрос в БД, где он ищет нужную строку в таблице и заменяет элемент нововнесенными данными
- при поиске анкеты выбираются  все строки где ключ не соответствует ключу пользователя, и потом при помощи метода randint выбирает случайного пользователя
- при удалении анкеты создается запрос, который ищет ключ пользователя и удаляет соответствующую строку в таблице
- обновление БД после каждого запроса.

## Работа БД при запуске:
- запуск **main.py** активирует цепочку run.py-> db.py, которая при каждом запуске **main.py** делает проверку и подключение к таблице БД, и при ее отсутствии создает ту самую таблицу.
- в методе create_form если у вас до этого не было анкеты, создается новая строка с уникальным ключом(в виде id вашего чата, который также потребуется в отправке вам сообщений) и пустыми полями для дальнейшего заполнения,при помощи запроса insert
- в методах set_<название поля> и set_update_<название поля> создаются изменения в таблице в таком порядке: запись нового значения полученного от пользователя через сообщение боту, создание запроса обновления  данных в строке анкеты данного пользователя,выполнение самого запроса, сохранение обновленной таблицы.
- в методах show_form,show_update_form, search_form создается поисковый запрос в таблице из которой берутся данные  для анкеты
- в методе delete_form_end создается запрос на удаление, который после этого сразу выполняется,после чего результат сохраняется


